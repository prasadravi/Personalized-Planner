<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <title>Your Personalized Workout & Diet Plan</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="result-page">
    <header class="result-header">
      <div>
        <h1>Your Personalized Workout & Diet Plan</h1>
        <p class="muted">Generated for <strong th:text="${profile.name}">User</strong></p>
      </div>
      <div class="header-actions">
        <a href="/" class="btn ghost">Back to Form</a>
      </div>
    </header>

    <main class="result-content">
      <!-- Summary card -->
      <section class="card summary-card">
        <h2>Summary</h2>
        <div class="summary-grid">
          <div><span class="label">Name</span><div class="value" th:text="${profile.name}">—</div></div>
          <div><span class="label">Goal</span><div class="value" th:text="${profile.goal}">—</div></div>
          <div><span class="label">Target Calories/Day</span><div class="value" th:text="${dailyCalories}">—</div></div>
          <div><span class="label">Daily Budget</span><div class="value">₹<span th:text="${dailyBudget}">0</span></div></div>
          <div><span class="label">Weekly Budget</span><div class="value">₹<span th:text="${weeklyBudget}">0</span></div></div>
          <div><span class="label">Estimated Weekly Cost</span><div class="value">₹<span th:text="${weeklyCost}">0</span></div></div>
        </div>
      </section>

      <!-- Workout plan: 7-day cards -->
      <section class="card workout-card">
        <h2>Weekly Workout Plan</h2>

        <div th:if="${weeklyPlan != null and weeklyPlan.days != null}">
          <div class="days-grid">
            <div class="day" th:each="day, i : ${weeklyPlan.days}">
              <div class="day-header">
                <div class="day-title">Day <span th:text="${i.index + 1}">1</span></div>
                <div class="day-type" th:text="${day.restDay ? 'REST' : 'WORKOUT'}"></div>
              </div>

              <div th:if="${!day.restDay}">
                <ol class="exercise-list">
                  <li th:each="ex : ${day.workout}">
                    <div class="ex-name" th:text="${ex.name}">Exercise</div>
                    <div class="ex-meta">
                      <span th:text="${ex.muscleGroup}">Group</span> •
                      <span th:text="${ex.intensity}">Intensity</span> •
                      <span th:text="${ex.estMinutes}">min</span>
                    </div>
                  </li>
                </ol>
              </div>

              <div th:if="${day.restDay}" class="rest-note">
                Rest day — focus on recovery & light mobility.
              </div>
            </div>
          </div>
        </div>

        <p th:if="${weeklyPlan == null or weeklyPlan.days == null}" class="muted">
          (Workout plan will appear here once generated.)
        </p>
      </section>

      <!-- Meal plan: collapsible days -->
      <section class="card meals-card">
        <h2>Weekly Meal Plan</h2>

        <div th:if="${weeklyPlan != null and weeklyPlan.days != null}">
          <div class="meals-accordion">
            <div th:each="day, i : ${weeklyPlan.days}" class="meal-day">
              <button class="accordion-toggle">
                <span>Day <span th:text="${i.index + 1}">1</span></span>
                <small> kcal: <span th:text="${day.totalCalories}">0</span> / target: <span th:text="${day.targetCalories}">0</span> • ₹<span th:text="${day.cost}">0</span></small>
              </button>
              <div class="accordion-panel">
                <ol class="meal-list">
                  <li th:each="meal, idx : ${day.meals}">
                    <div class="meal-row">
                      <div class="meal-name"><strong th:text="${meal.name}">Meal</strong> — <em th:text="${meal.cuisine}">Cuisine</em></div>
                      <div class="meal-nutrition"> <span th:text="${meal.calories}">0</span> kcal • P:<span th:text="${meal.protein}">0</span>g</div>
                      <div class="meal-cost">₹<span th:text="${meal.cost}">0</span></div>
                    </div>
                  </li>
                </ol>
              </div>
            </div>
          </div>
        </div>

        <p th:if="${weeklyPlan == null or weeklyPlan.days == null}" class="muted">
          (Meal plan will appear here once generated.)
        </p>
      </section>

      <!-- Shopping list -->
      <section class="card shopping-card">
        <h2>Shopping List</h2>

        <div th:if="${shoppingList != null}">
          <table class="shopping-table">
            <thead><tr><th>Ingredient</th><th>Qty</th></tr></thead>
            <tbody>
              <tr th:each="item : ${shoppingList}">
                <td th:text="${item.key}">Ingredient</td>
                <td th:text="${item.value}">1</td>
              </tr>
            </tbody>
          </table>
        </div>

        <p th:if="${shoppingList == null}" class="muted">(Shopping list will be generated after plan creation.)</p>
      </section>
    </main>

    <footer class="result-footer muted">Made with ❤️ — Personalized Planner</footer>
  </div>

  <script>
    // small accordion behavior used by Thymeleaf-rendered results
    document.addEventListener('DOMContentLoaded', function(){
      document.querySelectorAll('.accordion-toggle').forEach(btn=>{
        btn.addEventListener('click', ()=> {
          btn.classList.toggle('open');
          const panel = btn.nextElementSibling;
          if(panel.style.maxHeight) panel.style.maxHeight = null;
          else panel.style.maxHeight = panel.scrollHeight + 'px';
        });
      });
      // auto-open first day if present
      const first = document.querySelector('.accordion-toggle');
      if(first) { first.click(); }
    });
  </script>
</body>
</html>
